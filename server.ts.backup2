// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

import crypto from 'crypto';
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

import express from 'express';
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

import cors from 'cors';
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

import helmet from 'helmet';
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

import compression from 'compression';
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

import verificationRoutes from './routes/verification-routes';
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// ========================
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// OBSERVER ACCESS CONTROL
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// ========================
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// Observer token system
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

interface ObserverToken {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  token: string;
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  expiresAt: Date;
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  allowedEndpoints: string[];
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  createdAt: Date;
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

}
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

const observerTokens: Map<string, ObserverToken> = new Map();
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

function generateObserverToken(allowedEndpoints: string[]): string {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  const token = crypto.randomBytes(32).toString('hex');
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  const expiresAt = new Date(Date.now() + 60 * 24 * 60 * 60 * 1000); // 60 days
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  observerTokens.set(token, {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    token,
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    expiresAt,
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    allowedEndpoints,
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    createdAt: new Date()
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  });
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  console.log(`[Observer] Generated token for endpoints: ${allowedEndpoints.join(', ')}`);
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  return token;
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

}
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// Initialize with a default token if in development
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

if (process.env.NODE_ENV !== 'production') {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  const devToken = generateObserverToken([
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    '/health',
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    '/verification/health',
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    '/dashboard/stats',
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    '/verification/*'
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  ]);
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  console.log(`[Observer] Development token: ${devToken}`);
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

}
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

const app = express();
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// Observer middleware
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

app.use((req, res, next) => {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  // Skip auth for health checks and pilot info
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  if (req.path === '/health' || req.path === '/pilot-info' || req.path.startsWith('/admin/')) {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    return next();
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  }
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  const token = req.headers['x-observer-token'] as string;
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    return res.status(401).json({ 
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      error: 'Observer token required',
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      hint: 'Include X-Observer-Token header. Contact for pilot access.'
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    });
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  }
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    return res.status(403).json({ 
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      error: 'Invalid observer token',
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      hint: 'Token not recognized. Request new credentials.'
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    });
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  }
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  // Check expiration
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  if (observer.expiresAt < new Date()) {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    observerTokens.delete(token);
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    return res.status(401).json({ 
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      error: 'Observer token expired',
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      hint: 'Token valid for 60 days. Request renewal.'
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    });
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  }
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  // Check endpoint authorization
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  const path = req.path;
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  const isAllowed = observer.allowedEndpoints.some(endpoint => {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    if (endpoint.includes('*')) {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      const pattern = endpoint.replace('*', '.*');
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      return new RegExp(`^${pattern}$`).test(path);
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    }
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    return path.startsWith(endpoint);
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  });
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    return res.status(403).json({ 
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      error: 'Endpoint not authorized',
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      allowedEndpoints: observer.allowedEndpoints,
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      requested: path
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    });
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  }
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  // Add observer context to request
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  (req as any).observer = {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    token: observer.token,
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    accessType: 'observer'
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  };
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  next();
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

});
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

const PORT = process.env.PORT || 3001;
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// Middleware
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

app.use(helmet());
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

app.use(cors());
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

app.use(compression());
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

app.use(express.json());
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// Health endpoint
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

app.get('/health', (req, res) => {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  res.json({
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    status: 'healthy',
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    timestamp: new Date().toISOString(),
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    service: 'SeekReap API'
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  });
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

});
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// Dashboard stats endpoint
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

app.get('/dashboard/stats', (req, res) => {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  res.json({
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    summary: {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      totalEngagements: 0,
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      totalEvents: 0,
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

      avgEventsPerEngagement: 0
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    }
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  });
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

});
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// Verification routes
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

app.use('/verification', verificationRoutes);
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// Engagements endpoint
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

app.post('/engagements', (req, res) => {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  res.json({
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    success: true,
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    engagementId: `eng_${Date.now()}`,
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    userId: req.body.userId || 'unknown',
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

    createdAt: new Date().toISOString(),
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  });
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

});
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});


// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

// Start server - ONLY ONCE
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

app.listen(PORT, () => {
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

  console.log(`Server running on http://localhost:${PORT}`);
// ========================
// OBSERVER MANAGEMENT ENDPOINTS
// ========================

// Public pilot information
app.get('/pilot-info', (req, res) => {
  res.json({
    system: 'SeekReap Verification API',
    status: 'Pilot Active',
    version: '1.0.0',
    purpose: 'Regulatory verification observation platform',
    endpoints: {
      health: '/health',
      verification: '/verification/health',
      stats: '/dashboard/stats',
      evidence: '/verification/*'
    },
    access: {
      type: 'Token-based observation',
      duration: '60 days per token',
      permissions: 'Read-only, audit-only'
    },
    compliance: {
      determinism: 'Guaranteed',
      auditTrail: 'Full cryptographic evidence',
      boundaries: 'Enforced read-only access'
    },
    contact: 'For pilot access credentials, contact support'
  });
});

// Admin endpoint to generate tokens (protected by simple key)
app.post('/admin/observer-token', (req, res) => {
  const { adminKey, allowedEndpoints, clientName } = req.body;
  
  // Simple admin check - in production use proper auth
    return res.status(401).json({ error: 'Unauthorized: Invalid admin key' });
  }
  
  const defaultEndpoints = [
    '/health',
    '/verification/health',
    '/dashboard/stats',
    '/verification/*'
  ];
  
  const endpoints = allowedEndpoints || defaultEndpoints;
  const token = generateObserverToken(endpoints);
  
  res.json({ 
    success: true,
    token: token,
    client: clientName || 'unnamed-client',
    issuedAt: new Date().toISOString(),
    expiresAt: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),
    allowedEndpoints: endpoints,
    instructions: {
      header: 'X-Observer-Token',
      example: `curl -H 'X-Observer-Token: ${token}' https://seekreap-api.onrender.com/health`
    }
  });
});

// List active observer tokens (admin only)
app.get('/admin/observers', (req, res) => {
  const { adminKey } = req.query;
  
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  const tokens = Array.from(observerTokens.entries()).map(([token, data]) => ({
    token: token.substring(0, 8) + '...', // Partial for security
    issuedAt: data.createdAt.toISOString(),
    expiresAt: data.expiresAt.toISOString(),
    endpoints: data.allowedEndpoints,
    active: data.expiresAt > new Date()
  }));
  
  res.json({
    activeObservers: tokens.length,
    observers: tokens
  });
});

});